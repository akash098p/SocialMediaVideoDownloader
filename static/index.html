<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Social Media Downloader</title>
<link rel="website icon" type="png" href="SMD.png">

<style>
:root{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#f8fafc;
  --accent:#6366f1;
  --muted:#94a3b8;
}
.light{
  --bg:#f1f5f9;
  --card:#828275;
  --text:#111827;
  --muted:#6b7280;
}
body{
  margin:0;
  font-family:system-ui;
  background:var(--bg);
  color:var(--text);
  transition:.3s;
}
.container{
  max-width:960px;
  margin:auto;
  padding:14px;
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

/* üåó TOGGLE (same size, icon changes only) */
.toggle{
  width:42px;height:22px;border-radius:20px;
  background:#475569;position:relative;cursor:pointer;
}
.toggle span{
  width:18px;height:18px;background:white;border-radius:50%;
  position:absolute;top:2px;left:2px;transition:.3s;
}
.light .toggle span{left:22px}


/* PLATFORM BAR */
.snackbar{
  display:flex;
  gap:8px;
  margin:14px 0;
}
.snackbar button{
  flex:1;
  height:52px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:4px;
  border:none;
  border-radius:14px;
  color:white;
  font-size:12px;
  cursor:pointer;
  transition:.25s;
}
.snackbar button:hover{transform:translateY(-2px)}
.snackbar button:active{transform:scale(.97)}
.snackbar button.active{
  outline:3px solid rgba(255,255,255,.4);
}

/* Platform colors */
.youtube{background:#ff0000}
.instagram{background:linear-gradient(45deg,#f58529,#dd2a7b,#8134af)}
.facebook{background:#1877f2}
.x{background:#000}

/* Official Icons */
.snackbar svg{width:18px;height:18px;fill:white}

/* CARD */
.card{
  background:var(--card);
  border-radius:16px;
  padding:14px;
  margin-bottom:14px;
}

/* INPUT WITH CLEAR BUTTON (FIXED GRID ISSUE) */
.input-wrap{
  position:relative;
}
.input-wrap input{
  width:100%;
  box-sizing:border-box;
  padding:12px 40px 12px 12px; /* ‚úÖ space for ‚ùå */
  border-radius:12px;
  border:none;
}
.clear-btn{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  background:none;
  border:none;
  font-size:18px;
  color:var(--muted);
  cursor:pointer;
  display:none;
}
.clear-btn.show{display:block}

/* MAIN BUTTON */
button.main{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  background:var(--accent);
  color:white;
  font-size:15px;
  cursor:pointer;
}

/* SKELETON */
.skeleton{
  height:16px;
  border-radius:6px;
  background:linear-gradient(90deg,#334155,#475569,#334155);
  background-size:200%;
  animation:pulseLoad 1.2s infinite;
  margin-bottom:8px;
}
@keyframes pulseLoad{
  0%{background-position:0%}
  100%{background-position:200%}
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:10px;
}

/* PROGRESS */
.progress{
  height:8px;
  background:#334155;
  border-radius:8px;
  overflow:hidden;
}
.progress div{
  height:100%;
  width:0%;
  background:var(--accent);
}

/* TOAST */
.toast{
  position:fixed;
  bottom:-80px;
  left:50%;
  transform:translateX(-50%);
  background:#111827;
  color:white;
  padding:12px 18px;
  border-radius:14px;
  opacity:0;
  transition:.4s;
}
.toast.show{
  bottom:24px;
  opacity:1;
}
.title-wrap{
  display:flex;
  align-items:center;
  gap:10px;
}

.logo{
  width:42px;
  height:auto;
  flex-shrink:0;
}

/* Mobile friendly */
@media(max-width:600px){
  .logo{
    width:34px;
  }
  .title-wrap h3{
    font-size:16px;
  }
}

</style>
</head>

<body>
<div class="container">

<div class="header">
  <div class="title-wrap">
    <img src="SMD.png" alt="SMD Logo" class="logo">
  <h3>Social Media Video Downloader</h3>
  </div>

  <div class="toggle" onclick="toggleTheme()" id="themeIcon">üåô</div>
</div>

<!-- PLATFORM BAR -->
<div class="snackbar">
  <button class="youtube active" onclick="setPlatform('youtube',this)">
    <svg viewBox="0 0 24 24"><path d="M23.5 6.2s-.2-1.7-.9-2.4c-.8-.9-1.7-.9-2.1-1C17.4 2.5 12 2.5 12 2.5s-5.4 0-8.5.3c-.4.1-1.3.1-2.1 1-.7.7-.9 2.4-.9 2.4S0 8.1 0 10v1.9c0 1.9.5 3.8.5 3.8s.2 1.7.9 2.4c.8.9 1.9.9 2.4 1 1.7.2 7.2.3 7.2.3s5.4 0 8.5-.3c.4-.1 1.3-.1 2.1-1 .7-.7.9-2.4.9-2.4s.5-1.9.5-3.8V10c0-1.9-.5-3.8-.5-3.8zM9.5 14.5V7.5l6 3.5-6 3.5z"/></svg>
    YouTube
  </button>

  <button class="instagram" onclick="setPlatform('instagram',this)">
    <svg viewBox="0 0 24 24">
      <path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm5 5.5A4.5 4.5 0 1 0 16.5 12 4.5 4.5 0 0 0 12 7.5zm0 7.4A2.9 2.9 0 1 1 14.9 12 2.9 2.9 0 0 1 12 14.9zM17.5 6.5a1 1 0 1 1-1-1 1 1 0 0 1 1 1z"/>
    </svg>
    Instagram
  </button>

  <button class="facebook" onclick="setPlatform('facebook',this)">
    <svg viewBox="0 0 24 24"><path d="M22 12a10 10 0 1 0-11.5 9.9v-7H8v-3h2.5V9.5A3.5 3.5 0 0 1 14 6h2.5v3H14a1 1 0 0 0-1 1V12h3.5l-.5 3H13v7A10 10 0 0 0 22 12z"/></svg>
    Facebook
  </button>

  <button class="x" onclick="setPlatform('x',this)">
    <svg viewBox="0 0 24 24"><path d="M18.9 2H22l-7.4 8.5L23 22h-6.7l-5.2-6.7L5.6 22H2l7.9-9.1L1 2h6.8l4.7 6.1L18.9 2z"/></svg>
    X
  </button>
</div>

<div class="card">
  <div class="input-wrap">
    <input id="url" placeholder="Paste YouTube video URL" oninput="toggleClear()">
    <button class="clear-btn" id="clearBtn" onclick="clearInput()">√ó</button>
  </div>
  <button class="main" onclick="fetchInfo()">Fetch</button>
</div>

<div id="info"></div>

<h3>Active Downloads</h3>
<div id="jobs"></div>

<h3>Download History</h3>
<div id="history"></div>

</div>

<div id="toast" class="toast"></div>

<script>
const API=/*for locally*/ "http://127.0.0.1:8000"; /* for wifi */ /*"http://172.23.13.130:8000";*/
let platform="youtube";
const activeJobs={};

/* ---------- THEME ---------- */
function toggleTheme(){
  document.body.classList.toggle("light");
  themeIcon.textContent =
    document.body.classList.contains("light") ? "‚òÄ" : "üåô";
}

/* ---------- CLEAR INPUT ---------- */
function toggleClear(){
  clearBtn.classList.toggle("show", url.value.length>0);
}
function clearInput(){
  url.value="";
  toggleClear();
}

/* ---------- PLATFORM ---------- */
function setPlatform(p,btn){
  platform=p;
  document.querySelectorAll(".snackbar button")
    .forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");

  const placeholders={
    youtube:"Paste YouTube video URL",
    instagram:"Paste Instagram reel or post URL",
    facebook:"Paste Facebook video URL",
    x:"Paste X (Twitter) video URL"
  };
  url.placeholder=placeholders[p];
}

/* ---------- TOAST ---------- */
function showToast(msg){
  toast.textContent=msg;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),2500);
}

/* ---------- FETCH INFO ---------- */
async function fetchInfo(){
  if(!url.value.trim()){
    showToast("Paste a video URL");
    return;
  }

  showToast("Fetching video info...");
  info.innerHTML=`
    <div class="card">
      <div class="skeleton"></div>
      <div class="skeleton"></div>
      <div class="skeleton"></div>
    </div>
  `;

  const r=await fetch(`${API}/info?url=${encodeURIComponent(url.value)}`);
  const d=await r.json();

  let html=`<div class="card">
    <h3>${d.title}</h3>
    <img src="${d.thumbnail}" width="100%" style="border-radius:12px">
    <div class="grid">
  `;
  d.formats.forEach(f=>{
    html+=`<button class="main" onclick="start('${f.id}')">${f.label}</button>`;
  });
  html+=`</div></div>`;
  info.innerHTML=html;
}

/* ---------- START DOWNLOAD ---------- */
async function start(formatId){
  showToast("Download started");

  const r = await fetch(
    `${API}/download?url=${encodeURIComponent(url.value)}&format_id=${formatId}`,
    { method:"POST" }
  );
  const d = await r.json();

  createActiveJob(d.job_id);
}

/* ---------- ACTIVE JOB + HISTORY ---------- */
function createActiveJob(jobId){
  const div=document.createElement("div");
  div.className="card";
  div.id=`job-${jobId}`;

  div.innerHTML=`
    <div class="progress"><div></div></div>
  `;

  jobs.appendChild(div);
  const bar=div.querySelector(".progress div");

  const interval=setInterval(async()=>{
    const r=await fetch(`${API}/status/${jobId}`);
    const d=await r.json();

    bar.style.width=(d.progress||0)+"%";

    if(d.status==="done"){
      clearInterval(interval);
      div.remove();
      showToast("Download completed");

      // ‚úÖ Download button
      const downloadCard=document.createElement("div");
      downloadCard.className="card";
      downloadCard.innerHTML=`
        <a href="${API}/file/${d.file}" target="_blank">
          ‚¨á Download
        </a>
      `;
      jobs.appendChild(downloadCard);

      // ‚úÖ ADD TO HISTORY UI
      addToHistory(d.file);
    }
  },1000);

  activeJobs[jobId]={interval};
}

/* ---------- ADD TO HISTORY ---------- */
function addToHistory(file){
  if(document.getElementById(`hist-${file}`)) return;

  const div=document.createElement("div");
  div.className="card";
  div.id=`hist-${file}`;
  div.innerHTML=`
    <a href="${API}/file/${file}" target="_blank">${file}</a>
  `;
  history.prepend(div);
}

/* ---------- LOAD HISTORY ON PAGE LOAD ---------- */
async function loadHistory(){
  const r=await fetch(`${API}/history`);
  const h=await r.json();
  history.innerHTML="";
  h.forEach(addToHistory);
}

/* ---------- INIT ---------- */
loadHistory();
</script>
</body>
</html>
